import mido
import numpy as np
# Convert MIDI note number to frequency
def midi_to_freq(note):
    return 440.0 * (2 ** ((note - 69) / 12))
# Read MIDI file and extract note events
def process_midi(file_path):
    mid = mido.MidiFile(file_path)
    
    # Two lists for two simultaneous notes
    notes_list_1 = []
    notes_list_2 = []
    active_notes = set()  # Tracks currently playing notes
    last_time = 0  # Track elapsed time in ticks
    for msg in mid.tracks[0]:  # Assuming a single track
        if msg.time > 0:
            # Compute time delta in seconds
            duration = mido.tick2second(msg.time, mid.ticks_per_beat, 1000000)  
            #  500000 us per beat = 120 BPM
            # 1000000 us per beat = 60 BPM - means 1 duration per beat
            #  250000 = 240 bpm - quarter is a beat
            
            # If no active notes, insert a rest
            if len(active_notes) == 0:
                notes_list_1.append((0, duration))  # Rest
                notes_list_2.append((0, duration))  # Rest
            elif len(active_notes) == 1:
                note_freq = midi_to_freq(list(active_notes)[0])
                notes_list_1.append((note_freq, duration))
                notes_list_2.append((0, duration))  # No second note
            
            elif len(active_notes) >= 2:
                note_freqs = sorted([midi_to_freq(n) for n in active_notes])[:2]  # Take two lowest notes
                notes_list_1.append((note_freqs[0], duration))
                notes_list_2.append((note_freqs[1], duration))
        # Handle note events
        if msg.type == 'note_on' and msg.velocity > 0:
            active_notes.add(msg.note)
        elif msg.type in ['note_off', 'note_on'] and msg.velocity == 0:
            active_notes.discard(msg.note)
    return notes_list_1, notes_list_2
# Example usage
file_path = "final.mid"  # Replace with your MIDI file
notes_1, notes_2 = process_midi(file_path)
# Print output
print("Track 1:", len(notes_1), "notes", str(notes_1).replace("]","}").replace("[","{").replace(")","}").replace("(","{"))
print("Track 2:", len(notes_1), "notes", str(notes_2).replace("]","}").replace("[","{").replace(")","}").replace("(","{"))


# Track 1: [(493.8833012561241, 0.5), (415.3046975799451, 0.25), (440.0, 0.25), (493.8833012561241, 0.25), (659.2551138257398, 0.125), (587.3295358348151, 0.125), (440.0, 0.25), (415.3046975799451, 0.25), (329.6275569128699, 0.5), (329.6275569128699, 0.25), (440.0, 0.25), (523.2511306011972, 0.5), (493.8833012561241, 0.25), (440.0, 0.25), (415.3046975799451, 0.25), (329.6275569128699, 0.25), (415.3046975799451, 0.25), (440.0, 0.25), (493.8833012561241, 0.5), (523.2511306011972, 0.5), (440.0, 0.5), (329.6275569128699, 0.5), (329.6275569128699, 1.0), (0, 0.25), (349.2282314330039, 0.5), (440.0, 0.25), (523.2511306011972, 0.25), (523.2511306011972, 0.125), (523.2511306011972, 0.125), (493.8833012561241, 0.25), (440.0, 0.25), (391.99543598174927, 0.75), (329.6275569128699, 0.25), (391.99543598174927, 0.25), (440.0, 0.125), (391.99543598174927, 0.125), (349.2282314330039, 0.25), (329.6275569128699, 0.25), (415.3046975799451, 0.25), (329.6275569128699, 0.25), (415.3046975799451, 0.25), (440.0, 0.25), (493.8833012561241, 0.25), (415.3046975799451, 0.25), (523.2511306011972, 0.25), (415.3046975799451, 0.25), (440.0, 0.25), (329.6275569128699, 0.25), (329.6275569128699, 0.5), (329.6275569128699, 0.5), (0, 0.5), (261.6255653005986, 1.0), (220.0, 1.0), (246.94165062806206, 1.0), (207.65234878997256, 1.0), (220.0, 1.0), (164.81377845643496, 1.0), (164.81377845643496, 1.0), (207.65234878997256, 1.0), (261.6255653005986, 1.0), (220.0, 1.0), (246.94165062806206, 1.0), (207.65234878997256, 1.0), (220.0, 0.5), (261.6255653005986, 0.5), (329.6275569128699, 1.0), (329.6275569128699, 2.0)]
# Track 2: [(659.2551138257398, 0.5), (493.8833012561241, 0.25), (523.2511306011972, 0.25), (587.3295358348151, 0.25), (0, 0.125), (0, 0.125), (523.2511306011972, 0.25), (493.8833012561241, 0.25), (440.0, 0.5), (440.0, 0.25), (523.2511306011972, 0.25), (659.2551138257398, 0.5), (587.3295358348151, 0.25), (523.2511306011972, 0.25), (493.8833012561241, 0.25), (493.8833012561241, 0.25), (493.8833012561241, 0.25), (523.2511306011972, 0.25), (587.3295358348151, 0.5), (659.2551138257398, 0.5), (523.2511306011972, 0.5), (440.0, 0.5), (440.0, 1.0), (0, 0.25), (587.3295358348151, 0.5), (698.4564628660078, 0.25), (880.0, 0.25), (880.0, 0.125), (880.0, 0.125), (783.9908719634985, 0.25), (698.4564628660078, 0.25), (659.2551138257398, 0.75), (523.2511306011972, 0.25), (659.2551138257398, 0.25), (0, 0.125), (0, 0.125), (587.3295358348151, 0.25), (523.2511306011972, 0.25), (493.8833012561241, 0.25), (0, 0.25), (493.8833012561241, 0.25), (523.2511306011972, 0.25), (587.3295358348151, 0.25), (587.3295358348151, 0.25), (659.2551138257398, 0.25), (659.2551138257398, 0.25), (523.2511306011972, 0.25), (523.2511306011972, 0.25), (440.0, 0.5), (440.0, 0.5), (0, 0.5), (329.6275569128699, 1.0), (261.6255653005986, 1.0), (293.6647679174076, 1.0), (246.94165062806206, 1.0), (261.6255653005986, 1.0), (220.0, 1.0), (207.65234878997256, 1.0), (246.94165062806206, 1.0), (329.6275569128699, 1.0), (261.6255653005986, 1.0), (293.6647679174076, 1.0), (246.94165062806206, 1.0), (261.6255653005986, 0.5), (329.6275569128699, 0.5), (440.0, 1.0), (415.3046975799451, 2.0)]

# Track 1: 67 notes {{493.8833012561241, 1.0}, {415.3046975799451, 0.5}, {440.0, 0.5}, {493.8833012561241, 0.5}, {659.2551138257398, 0.25}, {587.3295358348151, 0.25}, {440.0, 0.5}, {415.3046975799451, 0.5}, {329.6275569128699, 1.0}, {329.6275569128699, 0.5}, {440.0, 0.5}, {523.2511306011972, 1.0}, {493.8833012561241, 0.5}, {440.0, 0.5}, {415.3046975799451, 0.5}, {329.6275569128699, 0.5}, {415.3046975799451, 0.5}, {440.0, 0.5}, {493.8833012561241, 1.0}, {523.2511306011972, 1.0}, {440.0, 1.0}, {329.6275569128699, 1.0}, {329.6275569128699, 2.0}, {0, 0.5}, {349.2282314330039, 1.0}, {440.0, 0.5}, {523.2511306011972, 0.5}, {523.2511306011972, 0.25}, {523.2511306011972, 0.25}, {493.8833012561241, 0.5}, {440.0, 0.5}, {391.99543598174927, 1.5}, {329.6275569128699, 0.5}, {391.99543598174927, 0.5}, {440.0, 0.25}, {391.99543598174927, 0.25}, {349.2282314330039, 0.5}, {329.6275569128699, 0.5}, {415.3046975799451, 0.5}, {329.6275569128699, 0.5}, {415.3046975799451, 0.5}, {440.0, 0.5}, {493.8833012561241, 0.5}, {415.3046975799451, 0.5}, {523.2511306011972, 0.5}, {415.3046975799451, 0.5}, {440.0, 0.5}, {329.6275569128699, 0.5}, {329.6275569128699, 1.0}, {329.6275569128699, 1.0}, {0, 1.0}, {261.6255653005986, 2.0}, {220.0, 2.0}, {246.94165062806206, 2.0}, {207.65234878997256, 2.0}, {220.0, 2.0}, {164.81377845643496, 2.0}, {164.81377845643496, 2.0}, {207.65234878997256, 2.0}, {261.6255653005986, 2.0}, {220.0, 2.0}, {246.94165062806206, 2.0}, {207.65234878997256, 2.0}, {220.0, 1.0}, {261.6255653005986, 1.0}, {329.6275569128699, 2.0}, {329.6275569128699, 4.0}}
# Track 2: 67 notes {{659.2551138257398, 1.0}, {493.8833012561241, 0.5}, {523.2511306011972, 0.5}, {587.3295358348151, 0.5}, {0, 0.25}, {0, 0.25}, {523.2511306011972, 0.5}, {493.8833012561241, 0.5}, {440.0, 1.0}, {440.0, 0.5}, {523.2511306011972, 0.5}, {659.2551138257398, 1.0}, {587.3295358348151, 0.5}, {523.2511306011972, 0.5}, {493.8833012561241, 0.5}, {493.8833012561241, 0.5}, {493.8833012561241, 0.5}, {523.2511306011972, 0.5}, {587.3295358348151, 1.0}, {659.2551138257398, 1.0}, {523.2511306011972, 1.0}, {440.0, 1.0}, {440.0, 2.0}, {0, 0.5}, {587.3295358348151, 1.0}, {698.4564628660078, 0.5}, {880.0, 0.5}, {880.0, 0.25}, {880.0, 0.25}, {783.9908719634985, 0.5}, {698.4564628660078, 0.5}, {659.2551138257398, 1.5}, {523.2511306011972, 0.5}, {659.2551138257398, 0.5}, {0, 0.25}, {0, 0.25}, {587.3295358348151, 0.5}, {523.2511306011972, 0.5}, {493.8833012561241, 0.5}, {0, 0.5}, {493.8833012561241, 0.5}, {523.2511306011972, 0.5}, {587.3295358348151, 0.5}, {587.3295358348151, 0.5}, {659.2551138257398, 0.5}, {659.2551138257398, 0.5}, {523.2511306011972, 0.5}, {523.2511306011972, 0.5}, {440.0, 1.0}, {440.0, 1.0}, {0, 1.0}, {329.6275569128699, 2.0}, {261.6255653005986, 2.0}, {293.6647679174076, 2.0}, {246.94165062806206, 2.0}, {261.6255653005986, 2.0}, {220.0, 2.0}, {207.65234878997256, 2.0}, {246.94165062806206, 2.0}, {329.6275569128699, 2.0}, {261.6255653005986, 2.0}, {293.6647679174076, 2.0}, {246.94165062806206, 2.0}, {261.6255653005986, 1.0}, {329.6275569128699, 1.0}, {440.0, 2.0}, {415.3046975799451, 4.0}}